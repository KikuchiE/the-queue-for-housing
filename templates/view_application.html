{% extends "base.html" %} {% load static %} {% block content %}
<div class="container mx-auto p-4 mt-10">
	<div class="bg-white p-6 rounded-lg shadow-md">
		<div class="flex justify-between items-center mb-6">
			<h1 class="text-2xl font-bold text-gray-800">Application Details</h1>
			{% if application.status == 'SUBMITTED' or application.status == 'UNDER_REVIEW' %}
			<a
				href="{% url 'edit_application' %}"
				class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition"
			>
				Edit Application
			</a>
			{% endif %}
		</div>

		<div class="grid md:grid-cols-2 gap-6">
			<!-- Application Overview -->
			<div class="bg-gray-50 p-4 rounded-lg">
				<h2 class="text-xl font-semibold mb-4 border-b pb-2">Application Overview</h2>
				<div class="space-y-3">
					<div class="flex justify-between">
						<span class="font-medium text-gray-600">Application Number:</span>
						<span class="font-bold">{{ application.application_number }}</span>
					</div>
					<div class="flex justify-between">
						<span class="font-medium text-gray-600">Who is it intended for:</span>
						<span class="font-bold">{% if application.is_for_ward %} For a ward {% else %} For myself {% endif %}</span>
					</div>
					<div class="flex justify-between">
						<span class="font-medium text-gray-600">Submission Date:</span>
						<span>{{ application.submission_date }}</span>
					</div>
					<div class="flex justify-between">
						<span class="font-medium text-gray-600">Current Status:</span>
						<span
							class="{% if application.status == 'SUBMITTED' %}text-blue-600 {% elif application.status == 'UNDER_REVIEW' %}text-yellow-600 {% elif application.status == 'IN_QUEUE' %}text-orange-600 {% elif application.status == 'HOUSING_OFFERED' %}text-green-600 {% elif application.status == 'ACCEPTED' %}text-green-800 {% else %}text-red-600 {% endif %} font-bold"
						>
							{{ application.status }}
						</span>
					</div>
					<div class="flex justify-between">
						<span class="font-medium text-gray-600">Priority Score:</span>
						<span>{{ application.priority_score }}</span>
					</div>
					{% if queue_position %}
					<div class="flex justify-between">
						<span class="font-medium text-gray-600">Queue Position:</span>
						<span class="font-bold text-blue-700">{{ queue_position }}</span>
					</div>
					{% endif %}
				</div>
			</div>

			<!-- Applicant Information -->
			<div class="bg-gray-50 p-4 rounded-lg">
				<h2 class="text-xl font-semibold mb-4 border-b pb-2">Personal Information</h2>
				<div class="space-y-3">
					<div class="flex justify-between">
						<span class="font-medium text-gray-600">Full Name:</span>
						<span>{{ application.applicant.first_name }} {{ application.applicant.last_name }}</span>
					</div>
					<div class="flex justify-between">
						<span class="font-medium text-gray-600">Monthly Income:</span>
						<span>{{ application.monthly_income|floatformat:2 }} ₽</span>
					</div>
					<div class="flex justify-between">
						<span class="font-medium text-gray-600">Current Living Area:</span>
						<span>{{ application.current_living_area|default:"Not Specified" }} м²</span>
					</div>
					<div class="flex justify-between">
						<span class="font-medium text-gray-600">Current Address:</span>
						<span>{{ application.current_address }}</span>
					</div>
					<div class="flex justify-between">
						<span class="font-medium text-gray-600">Homeless:</span>
						<span>{{ application.is_homeless|yesno:"Yes,No" }}</span>
					</div>
				</div>
			</div>
		</div>

		<!-- Family Composition -->
		<div class="bg-gray-50 p-4 rounded-lg mt-6">
			<h2 class="text-xl font-semibold mb-4 border-b pb-2">Family Composition</h2>
			<div class="grid md:grid-cols-2 gap-4">
				<div>
					<div class="flex justify-between mb-2">
						<span class="font-medium text-gray-600">Adults:</span>
						<span>{{ application.adults_count }}</span>
					</div>
					<div class="flex justify-between mb-2">
						<span class="font-medium text-gray-600">Children:</span>
						<span>{{ application.children_count }}</span>
					</div>
					<div class="flex justify-between mb-2">
						<span class="font-medium text-gray-600">Elderly:</span>
						<span>{{ application.elderly_count }}</span>
					</div>
				</div>
				<div>
					<div class="flex justify-between mb-2">
						<span class="font-medium text-gray-600">Single Parent:</span>
						<span>{{ application.is_single_parent|yesno:"Yes,No" }}</span>
					</div>
					<div class="flex justify-between mb-2">
						<span class="font-medium text-gray-600">Veteran Status:</span>
						<span>{{ application.is_veteran|yesno:"Yes,No" }}</span>
					</div>
					<div class="flex justify-between mb-2">
						<span class="font-medium text-gray-600">Disability Status:</span>
						<span>{{ application.has_disability|yesno:"Yes,No" }}</span>
					</div>
				</div>
			</div>
		</div>

		<!-- Uploaded Documents -->
		<div class="bg-gray-50 p-4 rounded-lg mt-6">
			<h2 class="text-xl font-semibold mb-4 border-b pb-2">Uploaded Documents</h2>
			{% if application.documents.exists %}
			<div class="grid md:grid-cols-2 gap-4">
				{% for doc in application.documents.all %}
				<div class="bg-white p-3 rounded shadow-sm">
					<div class="flex justify-between items-center">
						<span class="font-medium text-gray-600">{{ doc.get_document_type_display }}</span>
						<a href="{{ doc.file.url }}" target="_blank" class="text-blue-500 hover:text-blue-700 transition">
							View Document
						</a>
					</div>
					<div class="text-sm text-gray-500 mt-1">Uploaded: {{ doc.uploaded_at|date:"d M Y H:i" }}</div>
				</div>
				{% endfor %}
			</div>
			{% else %}
			<p class="text-gray-500">No documents have been uploaded.</p>
			{% endif %}
		</div>

		<!-- Application History -->
		<div class="bg-gray-50 p-4 rounded-lg mt-6">
			<h2 class="text-xl font-semibold mb-4 border-b pb-2">Application History</h2>
			{% if history %}
			<div class="overflow-x-auto">
				<table class="w-full text-sm">
					<thead>
						<tr class="bg-gray-100">
							<th class="p-2 text-left">Date</th>
							<th class="p-2 text-left">Previous Status</th>
							<th class="p-2 text-left">New Status</th>
							<th class="p-2 text-left">Modified By</th>
							<th class="p-2 text-left">Notes</th>
						</tr>
					</thead>
					<tbody>
						{% for entry in history %}
						<tr class="border-b">
							<td class="p-2">{{ entry.change_date|date:"d M Y H:i" }}</td>
							<td class="p-2">{{ entry.previous_status|default:"Initial Submission" }}</td>
							<td class="p-2">{{ entry.new_status }}</td>
							<td class="p-2">{{ entry.changed_by.first_name }} {{ entry.changed_by.last_name }}</td>
							<td class="p-2">{{ entry.notes|default:"No additional notes" }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			{% else %}
			<p class="text-gray-500">No application history available.</p>
			{% endif %}
		</div>
	</div>
</div>
{% endblock %} {% block extra_js %}
<script>
	document.addEventListener("DOMContentLoaded", function () {
		// Optional: Add any interactive features for the view application page
		const documentLinks = document.querySelectorAll('a[href*="documents"]');
		documentLinks.forEach((link) => {
			link.addEventListener("click", function (e) {
				e.preventDefault();
				window.open(this.href, "Document", "width=800,height=600");
			});
		});
	});
</script>
{% endblock %}
